---
title: "vis_9"
author: "judy teng"
date: "August 8, 2016"
output: html_document
---
```{r}
library(ggplot2)
library(dplyr)
library(tidyr)
library(readr)
library(stringr)

discount <- read_csv("updated_cleaned_four_cities.csv")

discount <- discount %>%
  select(`Weekly.Discount(%)`,`Monthly.Discount(%)`, Price, City) %>%
  mutate(`Weekly.Discount(%)` = str_replace(`Weekly.Discount(%)`,"unspecified", 0),
         `Monthly.Discount(%)` = str_replace(`Monthly.Discount(%)`, "unspecified",0))

no_discount <- discount %>%
  filter(`Monthly.Discount(%)` == 0) %>%
  mutate(Weekly.Price = Price,
         Monthly.Price = Price) %>%
  select(-`Monthly.Discount(%)`, -`Weekly.Discount(%)`)


have_discount <- discount %>%
  filter(`Monthly.Discount(%)` != 0) %>%
  mutate(Weekly.Price = (1- 0.01*as.numeric(`Weekly.Discount(%)`))*Price,
         Monthly.Price = (1- 0.01*as.numeric(`Monthly.Discount(%)`))*Price) %>%
  select(-`Monthly.Discount(%)`, -`Weekly.Discount(%)`)

discount_final <- rbind(no_discount, have_discount) %>%
  gather(key = time , value = price, Weekly.Price, Monthly.Price)
  

colnames(discount_final)[1] <- "Daily.Price"

ggplot(discount_final, aes(x= Daily.Price, 
                           y = price, 
                           color = City)) +
  geom_point(alpha = 0.5, stroke = 0.5) +
  geom_smooth(method = "lm", 
              se = FALSE,
              fullrange = TRUE) +
  facet_grid(~time) +
  coord_cartesian(xlim = c(0,350), ylim = c(10,350)) +
  labs(x = "Original Daily Price (USD)", 
       y = "Discounted Daily Price (USD)",
       title = "Figure 3: Degree of Discounting Based On Duration") +
  scale_y_log10(breaks = c(0, 50, 100,200, 400, 700, 1000)) +
  scale_x_continuous(breaks = seq(0,1000,100)) +
  geom_abline(intercept = 0, 
              slope = 1,
              size = 1) +
  theme_gdocs() 
theme(axis.title.x = element_text(size = 16, face = "bold"),
      axis.title.y = element_text(size = 16, face = "bold"),
      axis.text.y = element_text(face = "bold", size = 15),
      axis.text.x = element_text(face = "bold", size = 13),
      legend.text = element_text(face = "bold", size = 13),
      legend.title = element_text(face = "bold", size = 15))

```

```

